<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Composable.Transformer</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--without-K</a> <a id="25" class="Pragma">--safe</a> <a id="32" class="Symbol">#-}</a>

<a id="37" class="Keyword">module</a> <a id="44" href="Composable.Transformer.html" class="Module">Composable.Transformer</a> <a id="67" class="Keyword">where</a>

<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Composable.Data.Core.html" class="Module">Composable.Data.Core</a>

<a id="108" class="Keyword">open</a> <a id="113" class="Keyword">import</a> <a id="120" href="Data.Product.html" class="Module">Data.Product</a>
<a id="133" class="Keyword">open</a> <a id="138" class="Keyword">import</a> <a id="145" href="Data.These.html" class="Module">Data.These</a>
<a id="156" class="Keyword">open</a> <a id="161" class="Keyword">import</a> <a id="168" href="Data.List.html" class="Module">Data.List</a>

<a id="179" class="Keyword">open</a> <a id="184" class="Keyword">import</a> <a id="191" href="Relation.Unary.html" class="Module">Relation.Unary</a> <a id="206" class="Keyword">hiding</a> <a id="213" class="Symbol">(</a><a id="214" href="Relation.Unary.html#3690" class="Function Operator">⌊_⌋</a><a id="217" class="Symbol">)</a>
<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="Relation.Ternary.Core.html" class="Module">Relation.Ternary.Core</a>
<a id="253" class="Keyword">open</a> <a id="258" class="Keyword">import</a> <a id="265" href="Relation.Ternary.Structures.Syntax.html" class="Module">Relation.Ternary.Structures.Syntax</a> <a id="300" class="Keyword">hiding</a> <a id="307" class="Symbol">(</a><a id="308" href="Relation.Ternary.Structures.PartialJoinoid.html#1135" class="Function Operator">_∣_</a><a id="311" class="Symbol">)</a>
<a id="313" class="Keyword">open</a> <a id="318" class="Keyword">import</a> <a id="325" href="Relation.Binary.Structures.html" class="Module">Relation.Binary.Structures</a>
<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Relation.Binary.Bundles.html" class="Module">Relation.Binary.Bundles</a>
<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="438" class="Symbol">as</a> <a id="441" class="Module">P</a> <a id="443" class="Keyword">using</a> <a id="449" class="Symbol">(</a><a id="450" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="453" class="Symbol">;</a> <a id="455" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="459" class="Symbol">)</a>
<a id="461" class="Keyword">open</a> <a id="466" href="Relation.Binary.PropositionalEquality.Core.html#2647" class="Module">P.≡-Reasoning</a>

<a id="481" class="Keyword">open</a> <a id="486" class="Keyword">import</a> <a id="493" href="Function.html" class="Module">Function</a> <a id="502" class="Keyword">using</a> <a id="508" class="Symbol">(</a><a id="509" href="Function.Base.html#615" class="Function">id</a><a id="511" class="Symbol">;</a> <a id="513" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="521" class="Symbol">;</a> <a id="523" href="Function.Base.html#1031" class="Function Operator">_∘_</a><a id="526" class="Symbol">;</a> <a id="528" href="Function.Bundles.html#6277" class="Record">Inverse</a><a id="535" class="Symbol">;</a> <a id="537" href="Function.Base.html#1919" class="Function Operator">_$_</a><a id="540" class="Symbol">)</a>
<a id="542" class="Keyword">open</a> <a id="547" class="Keyword">import</a> <a id="554" href="Function.Bundles.html" class="Module">Function.Bundles</a>

<a id="572" class="Keyword">open</a> <a id="577" class="Keyword">import</a> <a id="584" href="Relation.Ternary.Construct.Sets.Union.html" class="Module">Relation.Ternary.Construct.Sets.Union</a>
<a id="622" class="Keyword">open</a> <a id="627" class="Keyword">import</a> <a id="634" href="Relation.Ternary.Construct.Sets.html" class="Module">Relation.Ternary.Construct.Sets</a>

<a id="667" class="Keyword">open</a> <a id="672" class="Keyword">import</a> <a id="679" href="Relation.Ternary.Construct.Function.html" class="Module">Relation.Ternary.Construct.Function</a>

<a id="716" class="Keyword">open</a> <a id="721" href="Relation.Ternary.Construct.Sets.Union.html#3689" class="Module">Union</a>

<a id="728" class="Keyword">module</a> <a id="735" href="Composable.Transformer.html#735" class="Module">_</a> <a id="737" class="Keyword">where</a>

  <a id="746" class="Comment">-- Universe transformer; takes a `Set`-indexed universe `U` and transform</a>
  <a id="822" class="Comment">-- it to an &quot;open&quot; universe that only assumes a lower bound `I` on it&#39;s index,</a>
  <a id="903" class="Comment">-- instead of picking a fixed type. </a>
  <a id="942" class="Keyword">record</a> <a id="949" href="Composable.Transformer.html#949" class="Record">Open</a> <a id="954" class="Symbol">(</a><a id="955" href="Composable.Transformer.html#955" class="Bound">U</a> <a id="957" class="Symbol">:</a> <a id="959" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="963" class="Symbol">→</a> <a id="965" href="Agda.Primitive.html#326" class="Primitive">Set₁</a><a id="969" class="Symbol">)</a> <a id="971" class="Symbol">(</a><a id="972" href="Composable.Transformer.html#972" class="Bound">I</a> <a id="974" class="Symbol">:</a> <a id="976" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="980" class="Symbol">→</a> <a id="982" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="985" class="Symbol">)</a> <a id="987" class="Symbol">:</a> <a id="989" href="Agda.Primitive.html#326" class="Primitive">Set₁</a> <a id="994" class="Keyword">where</a> 
    <a id="1005" class="Keyword">field</a>
      <a id="1017" href="Composable.Transformer.html#1017" class="Field">closer</a> <a id="1024" class="Symbol">:</a> <a id="1026" class="Symbol">∀</a> <a id="1028" class="Symbol">{</a><a id="1029" href="Composable.Transformer.html#1029" class="Bound">X</a><a id="1030" class="Symbol">}</a> <a id="1032" class="Symbol">→</a> <a id="1034" href="Composable.Transformer.html#972" class="Bound">I</a> <a id="1036" href="Composable.Transformer.html#1029" class="Bound">X</a> <a id="1038" href="Relation.Ternary.Core.html#1463" class="Function Operator">≤</a> <a id="1040" href="Composable.Transformer.html#1029" class="Bound">X</a> <a id="1042" class="Symbol">→</a> <a id="1044" href="Composable.Transformer.html#955" class="Bound">U</a> <a id="1046" href="Composable.Transformer.html#1029" class="Bound">X</a>

  <a id="1051" class="Keyword">open</a> <a id="1056" href="Composable.Transformer.html#949" class="Module">Open</a> <a id="1061" class="Keyword">public</a>

  <a id="1071" class="Keyword">infix</a> <a id="1077" class="Number">10</a> <a id="1080" href="Composable.Transformer.html#1115" class="Function Operator">⟪_⟫</a>

  <a id="1087" class="Comment">-- Shorthand for `closer`</a>
  <a id="1115" href="Composable.Transformer.html#1115" class="Function Operator">⟪_⟫</a> <a id="1119" class="Symbol">:</a> <a id="1121" class="Symbol">∀</a> <a id="1123" class="Symbol">{</a><a id="1124" href="Composable.Transformer.html#1124" class="Bound">P</a> <a id="1126" href="Composable.Transformer.html#1126" class="Bound">F</a> <a id="1128" href="Composable.Transformer.html#1128" class="Bound">X</a><a id="1129" class="Symbol">}</a> <a id="1131" class="Symbol">→</a> <a id="1133" href="Composable.Transformer.html#949" class="Record">Open</a> <a id="1138" href="Composable.Transformer.html#1124" class="Bound">P</a> <a id="1140" href="Composable.Transformer.html#1126" class="Bound">F</a> <a id="1142" class="Symbol">→</a> <a id="1144" href="Composable.Transformer.html#1126" class="Bound">F</a> <a id="1146" href="Composable.Transformer.html#1128" class="Bound">X</a> <a id="1148" href="Relation.Ternary.Core.html#1463" class="Function Operator">≤</a> <a id="1150" href="Composable.Transformer.html#1128" class="Bound">X</a> <a id="1152" class="Symbol">→</a> <a id="1154" href="Composable.Transformer.html#1124" class="Bound">P</a> <a id="1156" href="Composable.Transformer.html#1128" class="Bound">X</a>
  <a id="1160" href="Composable.Transformer.html#1115" class="Function Operator">⟪</a> <a id="1162" href="Composable.Transformer.html#1162" class="Bound">D</a> <a id="1164" href="Composable.Transformer.html#1115" class="Function Operator">⟫</a> <a id="1166" class="Symbol">=</a> <a id="1168" href="Composable.Transformer.html#1017" class="Field">closer</a> <a id="1175" href="Composable.Transformer.html#1162" class="Bound">D</a>

  <a id="1180" href="Composable.Transformer.html#1180" class="Function Operator">_⟨$$⟩_</a> <a id="1187" class="Symbol">:</a> <a id="1189" class="Symbol">∀</a> <a id="1191" class="Symbol">{</a><a id="1192" href="Composable.Transformer.html#1192" class="Bound">P</a> <a id="1194" href="Composable.Transformer.html#1194" class="Bound">Q</a> <a id="1196" class="Symbol">:</a> <a id="1198" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1202" class="Symbol">→</a> <a id="1204" href="Agda.Primitive.html#326" class="Primitive">Set₁</a><a id="1208" class="Symbol">}</a> <a id="1210" class="Symbol">→</a> <a id="1212" href="Relation.Unary.html#3359" class="Function">∀[</a> <a id="1215" href="Composable.Transformer.html#1192" class="Bound">P</a> <a id="1217" href="Relation.Unary.html#4338" class="Function Operator">⇒</a> <a id="1219" href="Composable.Transformer.html#1194" class="Bound">Q</a> <a id="1221" href="Relation.Unary.html#3359" class="Function">]</a> <a id="1223" class="Symbol">→</a> <a id="1225" href="Relation.Unary.html#3359" class="Function">∀[</a> <a id="1228" href="Composable.Transformer.html#949" class="Record">Open</a> <a id="1233" href="Composable.Transformer.html#1192" class="Bound">P</a> <a id="1235" href="Relation.Unary.html#4338" class="Function Operator">⇒</a> <a id="1237" href="Composable.Transformer.html#949" class="Record">Open</a> <a id="1242" href="Composable.Transformer.html#1194" class="Bound">Q</a> <a id="1244" href="Relation.Unary.html#3359" class="Function">]</a>
  <a id="1248" href="Composable.Transformer.html#1017" class="Field">closer</a> <a id="1255" class="Symbol">(</a><a id="1256" href="Composable.Transformer.html#1256" class="Bound">f</a> <a id="1258" href="Composable.Transformer.html#1180" class="Function Operator">⟨$$⟩</a> <a id="1263" href="Composable.Transformer.html#1263" class="Bound">p</a><a id="1264" class="Symbol">)</a> <a id="1266" href="Composable.Transformer.html#1266" class="Bound">ext</a> <a id="1270" class="Symbol">=</a> <a id="1272" href="Composable.Transformer.html#1256" class="Bound">f</a> <a id="1274" class="Symbol">(</a><a id="1275" href="Composable.Transformer.html#1017" class="Field">closer</a> <a id="1282" href="Composable.Transformer.html#1263" class="Bound">p</a> <a id="1284" href="Composable.Transformer.html#1266" class="Bound">ext</a><a id="1287" class="Symbol">)</a>

  <a id="1292" class="Comment">-- Open universes behave monotonically under subtyping</a>
  <a id="1349" class="Comment">--</a>
  <a id="1354" class="Comment">-- Put otherwise: we can always assume a larger lower bound on (i.e., weaken) the index</a>
  <a id="1444" href="Composable.Transformer.html#1444" class="Function">open-mono</a> <a id="1454" class="Symbol">:</a> <a id="1456" class="Symbol">∀</a> <a id="1458" class="Symbol">{</a><a id="1459" href="Composable.Transformer.html#1459" class="Bound">P</a> <a id="1461" href="Composable.Transformer.html#1461" class="Bound">I</a> <a id="1463" href="Composable.Transformer.html#1463" class="Bound">J</a><a id="1464" class="Symbol">}</a> <a id="1466" class="Symbol">→</a> <a id="1468" href="Composable.Transformer.html#949" class="Record">Open</a> <a id="1473" href="Composable.Transformer.html#1459" class="Bound">P</a> <a id="1475" href="Composable.Transformer.html#1461" class="Bound">I</a> <a id="1477" class="Symbol">→</a> <a id="1479" href="Composable.Transformer.html#1461" class="Bound">I</a> <a id="1481" href="Relation.Ternary.Core.html#1463" class="Function Operator">≤</a> <a id="1483" href="Composable.Transformer.html#1463" class="Bound">J</a> <a id="1485" class="Symbol">→</a> <a id="1487" href="Composable.Transformer.html#949" class="Record">Open</a> <a id="1492" href="Composable.Transformer.html#1459" class="Bound">P</a> <a id="1494" href="Composable.Transformer.html#1463" class="Bound">J</a>
  <a id="1498" href="Composable.Transformer.html#1017" class="Field">closer</a> <a id="1505" class="Symbol">(</a><a id="1506" href="Composable.Transformer.html#1444" class="Function">open-mono</a> <a id="1516" href="Composable.Transformer.html#1516" class="Bound">D</a> <a id="1518" class="Symbol">(_</a> <a id="1521" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1523" href="Composable.Transformer.html#1523" class="Bound">σ₁</a><a id="1525" class="Symbol">))</a> <a id="1528" href="Composable.Transformer.html#1528" class="Bound">σ₂</a> <a id="1531" class="Symbol">=</a> <a id="1533" href="Composable.Transformer.html#1017" class="Field">closer</a> <a id="1540" href="Composable.Transformer.html#1516" class="Bound">D</a> <a id="1542" class="Symbol">(</a><a id="1543" href="Relation.Ternary.Structures.PartialSemigroup.html#2782" class="Function">≤-trans</a> <a id="1551" class="Symbol">(_</a> <a id="1554" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1556" href="Composable.Transformer.html#1523" class="Bound">σ₁</a> <a id="1559" class="Symbol">_)</a> <a id="1562" href="Composable.Transformer.html#1528" class="Bound">σ₂</a><a id="1564" class="Symbol">)</a>

  
  <a id="1572" class="Comment">-- `E ▿ ξ` = widen `E` using extension fact `ξ`</a>
  <a id="1622" class="Keyword">syntax</a> <a id="1629" href="Composable.Transformer.html#1444" class="Function">open-mono</a> <a id="1639" class="Bound">px</a> <a id="1642" class="Bound">σ</a> <a id="1644" class="Symbol">=</a> <a id="1646" class="Bound">px</a> <a id="1649" class="Function">▿</a> <a id="1651" class="Bound">σ</a>
</pre></body></html>